_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[14],{"469l":function(e,t,a){"use strict";var n=a("wx14"),r=a("Ff2n"),s=a("q1tI"),c=(a("17x9"),a("iuhU")),i=a("H2TA"),o=a("5AJ6"),u=Object(o.a)(s.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var l=s.forwardRef((function(e,t){var a=e.alt,i=e.children,o=e.classes,l=e.className,m=e.component,f=void 0===m?"div":m,d=e.imgProps,p=e.sizes,g=e.src,h=e.srcSet,b=e.variant,j=void 0===b?"circle":b,v=Object(r.a)(e,["alt","children","classes","className","component","imgProps","sizes","src","srcSet","variant"]),y=null,O=function(e){var t=e.src,a=e.srcSet,n=s.useState(!1),r=n[0],c=n[1];return s.useEffect((function(){if(t||a){c(!1);var e=!0,n=new Image;return n.src=t,n.srcSet=a,n.onload=function(){e&&c("loaded")},n.onerror=function(){e&&c("error")},function(){e=!1}}}),[t,a]),r}({src:g,srcSet:h}),w=g||h,x=w&&"error"!==O;return y=x?s.createElement("img",Object(n.a)({alt:a,src:g,srcSet:h,sizes:p,className:o.img},d)):null!=i?i:w&&a?a[0]:s.createElement(u,{className:o.fallback}),s.createElement(f,Object(n.a)({className:Object(c.a)(o.root,o.system,o[j],l,!x&&o.colorDefault),ref:t},v),y)}));t.a=Object(i.a)((function(e){return{root:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},colorDefault:{color:e.palette.background.default,backgroundColor:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[600]},circle:{},rounded:{borderRadius:e.shape.borderRadius},square:{borderRadius:0},img:{width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4},fallback:{width:"75%",height:"75%"}}}),{name:"MuiAvatar"})(l)},IsqK:function(e,t,a){"use strict";var n=a("wx14"),r=a("Ff2n"),s=a("q1tI"),c=(a("17x9"),a("iuhU")),i=a("H2TA"),o=a("ofer"),u=a("MquD"),l=s.forwardRef((function(e,t){var a=e.children,i=e.classes,l=e.className,m=e.disableTypography,f=void 0!==m&&m,d=e.inset,p=void 0!==d&&d,g=e.primary,h=e.primaryTypographyProps,b=e.secondary,j=e.secondaryTypographyProps,v=Object(r.a)(e,["children","classes","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"]),y=s.useContext(u.a).dense,O=null!=g?g:a;null==O||O.type===o.a||f||(O=s.createElement(o.a,Object(n.a)({variant:y?"body2":"body1",className:i.primary,component:"span",display:"block"},h),O));var w=b;return null==w||w.type===o.a||f||(w=s.createElement(o.a,Object(n.a)({variant:"body2",className:i.secondary,color:"textSecondary",display:"block"},j),w)),s.createElement("div",Object(n.a)({className:Object(c.a)(i.root,l,y&&i.dense,p&&i.inset,O&&w&&i.multiline),ref:t},v),O,w)}));t.a=Object(i.a)({root:{flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},multiline:{marginTop:6,marginBottom:6},dense:{},inset:{paddingLeft:56},primary:{},secondary:{}},{name:"MuiListItemText"})(l)},SLcR:function(e,t,a){"use strict";var n=a("wx14"),r=a("Ff2n"),s=a("q1tI"),c=(a("17x9"),a("iuhU")),i=a("H2TA"),o=a("MquD"),u=s.forwardRef((function(e,t){var a=e.classes,i=e.className,u=Object(r.a)(e,["classes","className"]),l=s.useContext(o.a);return s.createElement("div",Object(n.a)({className:Object(c.a)(a.root,i,"flex-start"===l.alignItems&&a.alignItemsFlexStart),ref:t},u))}));t.a=Object(i.a)({root:{minWidth:56,flexShrink:0},alignItemsFlexStart:{marginTop:8}},{name:"MuiListItemAvatar"})(u)},YrAi:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return a("f/Qm")}])},"f/Qm":function(e,t,a){"use strict";a.r(t);var n=a("KQm4"),r=a("o0o1"),s=a.n(r),c=a("HaE+"),i=a("ODXe"),o=a("q1tI"),u=a.n(o),l=a("nOHt"),m=a("9Koi"),f=a("R/WZ"),d=a("tr08"),p=a("tRbT"),g=a("cBaE"),h=a("zOGZ"),b=a("3bhu"),j=a("kKAo"),v=a("ofer"),y=a("r9w1"),O=a("csfp"),w=a("PsDL"),x=a("LYUY"),N=Object(x.a)(u.a.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),S=u.a.createElement,E=Object(f.a)((function(e){return{messageContainer:{height:"100%",width:"100%"},messageGridContainer:{height:"100%",padding:e.spacing(2)},messageField:{width:"100%"},messageBubble:{padding:e.spacing(2),wordWrap:"break-word",height:"max-content"},messageArea:{height:"calc(100% - ".concat(e.spacing(18),"px)"),overflowY:"scroll",marginTop:e.spacing(2),marginBottom:e.spacing(2)},messageName:{fontSize:"0.75rem",opacity:"50%"}}})),k=function(e){var t=Object(d.a)(),a=E();return S(p.a,{item:!0,container:!0,justify:e.me?"flex-end":"flex-start"},S(p.a,{item:!0,xs:6},S(j.a,{className:a.messageBubble,elevation:0,style:{backgroundColor:t.palette[e.me?"primary":"secondary"].main}},function(){if(e.showName&&!e.me)return S(v.a,{className:a.messageName},"".concat(e.message.user.name))}(),S(v.a,null,e.message.data))))},C=function(e){var t=Object(m.a)().t,a=E(),n=Object(o.useState)(""),r=n[0],s=n[1],c=Object(o.useRef)(null);function l(){e.onSend&&""!=r&&e.onSend(r),s("")}return Object(o.useEffect)((function(){c&&c.current.scrollIntoView()}),[c,e.messages]),S(u.a.Fragment,null,S(j.a,{square:!0,className:a.messageContainer},S(p.a,{className:a.messageGridContainer,container:!0,direction:"column",spacing:2,justify:"flex-end"},S(p.a,{container:!0,alignItems:"center",justify:"center"},S(p.a,{item:!0},S(v.a,{variant:"h6"},e.users?e.users.map((function(e){return e.name})).join(", "):""))),S(p.a,{className:a.messageArea,container:!0,item:!0,spacing:2},e.messages?e.messages.map((function(t,a){var n=Object(i.a)(t,2),r=n[0],s=n[1];return S(k,{key:a,me:s,message:r,showName:e.users.length>1})})):"",S("div",{ref:c})),S(p.a,{container:!0,item:!0,alignItems:"center",spacing:2},S(p.a,{item:!0,xs:!0},S(y.a,{className:a.messageField,placeholder:t("Aa"),variant:"outlined",value:r,onChange:function(e){return s(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&l()}})),S(p.a,{item:!0},S(O.a,{title:t("Message")},S(w.a,{onClick:function(){return l()}},S(N,null))))))))},I=a("tVbE"),T=a("SLcR"),R=a("469l"),F=a("IsqK"),A=a("eD//"),q=u.a.createElement,_=Object(f.a)((function(e){return{container:{height:"100%",width:"100%",padding:e.spacing(2)},chatHeadsContainer:{height:"100%",width:"100%",overflowY:"scroll"},chatHeadContainer:{borderRadius:"".concat(e.spacing(1),"px")}}})),P=function(e){var t=_();return q(I.a,{className:t.chatHeadContainer,button:!0,onClick:function(){return e.onSelect(e.users)}},q(T.a,null,q(R.a,null,e.users[0].name.split(" ").map((function(e){return e[0]})).slice(0,2).join(""))),q(F.a,{primary:e.users.map((function(e){return e.name})).join(", "),secondary:e.children}))},H=function(e){Object(d.a)(),Object(m.a)().t;var t=_();return q(u.a.Fragment,null,q(j.a,{square:!0,className:t.container},q(A.a,{className:t.chatHeadsContainer},e.heads.map((function(t,a){return q(P,{key:a,users:t.users,onSelect:function(t){return e.onSelect(t)}},t.message)})))))},z=u.a.createElement,L=Object(f.a)((function(e){return{container:{width:"100%",padding:e.spacing(2)},bar:{width:"100%"}}})),M=function(e){Object(d.a)();var t=Object(m.a)().t,a=L();return z(u.a.Fragment,null,z(j.a,{square:!0,className:a.container},z(y.a,{className:a.bar,value:e.value,onChange:e.onChange,placeholder:t("Search"),variant:"outlined"})))},D=u.a.createElement,B=Object(f.a)((function(e){return{}}));t.default=function(){var e=Object(l.useRouter)(),t=(Object(d.a)(),B(),Object(m.a)().t,Object(g.c)()),a=Object(i.a)(t,2),r=a[0],f=a[1],j=Object(o.useState)([]),v=j[0],y=j[1],O=Object(o.useState)([]),w=O[0],x=O[1],N=Object(o.useState)(null),S=N[0],E=N[1],k=Object(o.useState)([]),I=k[0],T=k[1],R=Object(o.useState)(""),F=R[0],A=R[1],q=Object(o.useState)([]),_=q[0],P=q[1];return Object(o.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)("messages");case 2:(t=e.sent).messages&&y(t.messages);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e();var a=setInterval((function(){return e()}),1e4);return function(){clearInterval(a)}}),[]),Object(o.useEffect)((function(){r||f||e.push("/")}),[f,r]),Object(o.useEffect)((function(){var e=[],t={};Object(n.a)(v).reverse().forEach((function(a){var r=[a.user].concat(Object(n.a)(a.recipients?a.recipients:[]));if(r.length>1&&(r=r.filter((function(e){return e.id!=f.id}))),(r=r.sort((function(e,t){return e.name.localeCompare(t.name)}))).length>0){var s=r.map((function(e){return e.id})).join(",");t[s]||(e.push(s),t[s]={users:r,message:a.data})}})),T(e.map((function(e){return t[e]})))}),[v]),Object(o.useEffect)((function(){I&&I.length>0&&!S&&E(I[0].users)}),[S,I]),Object(o.useEffect)((function(){S&&x(v.filter((function(e){if(1===S.length&&S[0].id===f.id)return e.user.id===f.id&&e.recipients&&1===e.recipients.length&&e.recipients[0].id===f.id;var t=[e.user].concat(Object(n.a)(e.recipients?e.recipients:[]));return t.length==S.length+1&&[f].concat(Object(n.a)(S)).every((function(e){return t.some((function(t){return e.id===t.id}))}))})))}),[S,v,f]),Object(o.useEffect)((function(){""!=F&&Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)("users/index","find",{email:F});case 2:(t=e.sent).users&&P(t.users);case 4:case"end":return e.stop()}}),e)})))()}),[F]),r?D(h.a,null):D(u.a.Fragment,null,D(b.a,null),D(p.a,{style:{height:"91vh"},container:!0},D(p.a,{item:!0,container:!0,direction:"column",md:3,xs:6,style:{height:"100%"}},D(p.a,{item:!0},D(M,{value:F,onChange:function(e){return A(e.target.value)}})),D(p.a,{item:!0,xs:!0},D(H,{heads:""!=F?_.map((function(e){return{users:[e],message:""}})):I,onSelect:function(e){E(e),A("")}}))),D(p.a,{item:!0,container:!0,md:9,xs:6,style:{height:"100%"}},D(C,{users:S,messages:w.map((function(e){return[e,e.user.id==f.id]})),onSend:function(){var e=Object(c.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(f&&S&&S.length>0)){e.next=5;break}return e.next=3,Object(g.a)("messages","create",{recipients:S.map((function(e){return e.id})),data:t});case 3:a=e.sent,y([].concat(Object(n.a)(v),[a]));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}))))}}},[["YrAi",0,2,4,1,3,5,6,8,7]]]);