_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[14],{IsqK:function(e,t,a){"use strict";var n=a("wx14"),r=a("Ff2n"),s=a("q1tI"),c=(a("17x9"),a("iuhU")),i=a("H2TA"),o=a("ofer"),u=a("MquD"),l=s.forwardRef((function(e,t){var a=e.children,i=e.classes,l=e.className,m=e.disableTypography,f=void 0!==m&&m,d=e.inset,p=void 0!==d&&d,g=e.primary,h=e.primaryTypographyProps,b=e.secondary,j=e.secondaryTypographyProps,O=Object(r.a)(e,["children","classes","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"]),y=s.useContext(u.a).dense,v=null!=g?g:a;null==v||v.type===o.a||f||(v=s.createElement(o.a,Object(n.a)({variant:y?"body2":"body1",className:i.primary,component:"span",display:"block"},h),v));var w=b;return null==w||w.type===o.a||f||(w=s.createElement(o.a,Object(n.a)({variant:"body2",className:i.secondary,color:"textSecondary",display:"block"},j),w)),s.createElement("div",Object(n.a)({className:Object(c.a)(i.root,l,y&&i.dense,p&&i.inset,v&&w&&i.multiline),ref:t},O),v,w)}));t.a=Object(i.a)({root:{flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},multiline:{marginTop:6,marginBottom:6},dense:{},inset:{paddingLeft:56},primary:{},secondary:{}},{name:"MuiListItemText"})(l)},SLcR:function(e,t,a){"use strict";var n=a("wx14"),r=a("Ff2n"),s=a("q1tI"),c=(a("17x9"),a("iuhU")),i=a("H2TA"),o=a("MquD"),u=s.forwardRef((function(e,t){var a=e.classes,i=e.className,u=Object(r.a)(e,["classes","className"]),l=s.useContext(o.a);return s.createElement("div",Object(n.a)({className:Object(c.a)(a.root,i,"flex-start"===l.alignItems&&a.alignItemsFlexStart),ref:t},u))}));t.a=Object(i.a)({root:{minWidth:56,flexShrink:0},alignItemsFlexStart:{marginTop:8}},{name:"MuiListItemAvatar"})(u)},YrAi:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return a("f/Qm")}])},"f/Qm":function(e,t,a){"use strict";a.r(t);var n=a("KQm4"),r=a("o0o1"),s=a.n(r),c=a("HaE+"),i=a("ODXe"),o=a("q1tI"),u=a.n(o),l=a("nOHt"),m=a("9Koi"),f=a("R/WZ"),d=a("tr08"),p=a("tRbT"),g=a("cBaE"),h=a("zOGZ"),b=a("3bhu"),j=a("kKAo"),O=a("ofer"),y=a("r9w1"),v=a("csfp"),w=a("PsDL"),x=a("LYUY"),N=Object(x.a)(u.a.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),E=u.a.createElement,S=Object(f.a)((function(e){return{messageContainer:{height:"100%",width:"100%"},messageGridContainer:{height:"100%",padding:e.spacing(2)},messageField:{width:"100%"},messageBubble:{padding:e.spacing(2),wordWrap:"break-word",height:"max-content"},messageArea:{height:"calc(100% - ".concat(e.spacing(18),"px)"),overflowY:"scroll",marginTop:e.spacing(2),marginBottom:e.spacing(2)},messageName:{fontSize:"0.75rem",opacity:"50%"}}})),C=function(e){var t=Object(d.a)(),a=S();return E(p.a,{item:!0,container:!0,justify:e.me?"flex-end":"flex-start"},E(p.a,{item:!0,xs:6},E(j.a,{className:a.messageBubble,elevation:0,style:{backgroundColor:t.palette[e.me?"primary":"secondary"].main}},function(){if(e.showName&&!e.me)return E(O.a,{className:a.messageName},"".concat(e.message.user.name))}(),E(O.a,null,e.message.data))))},k=function(e){var t=Object(m.a)().t,a=S(),n=Object(o.useState)(""),r=n[0],s=n[1],c=Object(o.useRef)(null);function l(){e.onSend&&""!=r&&e.onSend(r),s("")}return Object(o.useEffect)((function(){c&&c.current.scrollIntoView()}),[c,e.messages]),E(u.a.Fragment,null,E(j.a,{square:!0,className:a.messageContainer},E(p.a,{className:a.messageGridContainer,container:!0,direction:"column",spacing:2,justify:"flex-end"},E(p.a,{container:!0,alignItems:"center",justify:"center"},E(p.a,{item:!0},E(O.a,{variant:"h6"},e.users?e.users.map((function(e){return e.name})).join(", "):""))),E(p.a,{className:a.messageArea,container:!0,item:!0,spacing:2},e.messages?e.messages.map((function(t,a){var n=Object(i.a)(t,2),r=n[0],s=n[1];return E(C,{key:a,me:s,message:r,showName:e.users.length>1})})):"",E("div",{ref:c})),E(p.a,{container:!0,item:!0,alignItems:"center",spacing:2},E(p.a,{item:!0,xs:!0},E(y.a,{className:a.messageField,placeholder:t("Aa"),variant:"outlined",value:r,onChange:function(e){return s(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&l()}})),E(p.a,{item:!0},E(v.a,{title:t("Message")},E(w.a,{onClick:function(){return l()}},E(N,null))))))))},T=a("tVbE"),I=a("SLcR"),_=a("469l"),q=a("IsqK"),F=a("eD//"),A=u.a.createElement,R=Object(f.a)((function(e){return{container:{height:"100%",width:"100%",padding:e.spacing(2)},chatHeadsContainer:{height:"100%",width:"100%",overflowY:"scroll"},chatHeadContainer:{borderRadius:"".concat(e.spacing(1),"px")}}})),H=function(e){var t=R();return A(T.a,{className:t.chatHeadContainer,button:!0,onClick:function(){return e.onSelect(e.users)}},A(I.a,null,A(_.a,null,e.users[0].name.split(" ").map((function(e){return e[0]})).slice(0,2).join(""))),A(q.a,{primary:e.users.map((function(e){return e.name})).join(", "),secondary:e.children}))},L=function(e){Object(d.a)(),Object(m.a)().t;var t=R();return A(u.a.Fragment,null,A(j.a,{square:!0,className:t.container},A(F.a,{className:t.chatHeadsContainer},e.heads.map((function(t,a){return A(H,{key:a,users:t.users,onSelect:function(t){return e.onSelect(t)}},t.message)})))))},P=u.a.createElement,B=Object(f.a)((function(e){return{container:{width:"100%",padding:e.spacing(2)},bar:{width:"100%"}}})),K=function(e){Object(d.a)();var t=Object(m.a)().t,a=B();return P(u.a.Fragment,null,P(j.a,{square:!0,className:a.container},P(y.a,{className:a.bar,value:e.value,onChange:e.onChange,placeholder:t("Search"),variant:"outlined"})))},M=u.a.createElement,Y=Object(f.a)((function(e){return{}}));t.default=function(){var e=Object(l.useRouter)(),t=(Object(d.a)(),Y(),Object(m.a)().t,Object(g.c)()),a=Object(i.a)(t,2),r=a[0],f=a[1],j=Object(o.useState)([]),O=j[0],y=j[1],v=Object(o.useState)([]),w=v[0],x=v[1],N=Object(o.useState)(null),E=N[0],S=N[1],C=Object(o.useState)([]),T=C[0],I=C[1],_=Object(o.useState)(""),q=_[0],F=_[1],A=Object(o.useState)([]),R=A[0],H=A[1];return Object(o.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)("messages");case 2:(t=e.sent).messages&&y(t.messages);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e();var a=setInterval((function(){return e()}),1e4);return function(){clearInterval(a)}}),[]),Object(o.useEffect)((function(){r||f||e.push("/")}),[f,r]),Object(o.useEffect)((function(){var e=[],t={};Object(n.a)(O).reverse().forEach((function(a){var r=[a.user].concat(Object(n.a)(a.recipients?a.recipients:[]));if(r.length>1&&(r=r.filter((function(e){return e.id!=f.id}))),(r=r.sort((function(e,t){return e.name.localeCompare(t.name)}))).length>0){var s=r.map((function(e){return e.id})).join(",");t[s]||(e.push(s),t[s]={users:r,message:a.data})}})),I(e.map((function(e){return t[e]})))}),[O]),Object(o.useEffect)((function(){T&&T.length>0&&!E&&S(T[0].users)}),[E,T]),Object(o.useEffect)((function(){E&&x(O.filter((function(e){if(1===E.length&&E[0].id===f.id)return e.user.id===f.id&&e.recipients&&1===e.recipients.length&&e.recipients[0].id===f.id;var t=[e.user].concat(Object(n.a)(e.recipients?e.recipients:[]));return t.length==E.length+1&&[f].concat(Object(n.a)(E)).every((function(e){return t.some((function(t){return e.id===t.id}))}))})))}),[E,O,f]),Object(o.useEffect)((function(){""!=q&&Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)("users/index","find",{email:q});case 2:(t=e.sent).users&&H(t.users);case 4:case"end":return e.stop()}}),e)})))()}),[q]),r?M(h.a,null):M(u.a.Fragment,null,M(b.a,null),M(p.a,{style:{height:"91vh"},container:!0},M(p.a,{item:!0,container:!0,direction:"column",md:3,xs:6,style:{height:"100%"}},M(p.a,{item:!0},M(K,{value:q,onChange:function(e){return F(e.target.value)}})),M(p.a,{item:!0,xs:!0},M(L,{heads:""!=q?R.map((function(e){return{users:[e],message:""}})):T,onSelect:function(e){S(e),F("")}}))),M(p.a,{item:!0,container:!0,md:9,xs:6,style:{height:"100%"}},M(k,{users:E,messages:w.map((function(e){return[e,e.user.id==f.id]})),onSend:function(){var e=Object(c.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(f&&E&&E.length>0)){e.next=5;break}return e.next=3,Object(g.a)("messages","create",{recipients:E.map((function(e){return e.id})),data:t});case 3:a=e.sent,y([].concat(Object(n.a)(O),[a]));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}))))}}},[["YrAi",0,2,4,1,3,5,6,8,7]]]);