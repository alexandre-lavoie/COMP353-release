_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[13],{YrAi:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return a("f/Qm")}])},"f/Qm":function(e,t,a){"use strict";a.r(t);var n=a("KQm4"),r=a("o0o1"),s=a.n(r),i=a("HaE+"),c=a("ODXe"),o=a("q1tI"),l=a.n(o),u=a("nOHt"),d=a("9Koi"),m=a("R/WZ"),f=a("tr08"),p=a("tRbT"),b=a("cBaE"),g=a("zOGZ"),h=a("3bhu"),v=a("kKAo"),j=a("ofer"),O=a("r9w1"),y=a("csfp"),x=a("PsDL"),w=a("LYUY"),N=Object(w.a)(l.a.createElement("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),C=l.a.createElement,E=Object(m.a)((function(e){return{messageContainer:{height:"100%",width:"100%"},messageGridContainer:{height:"100%",padding:e.spacing(2)},messageField:{width:"100%"},messageBubble:{padding:e.spacing(2),maxWidth:"60%",wordWrap:"break-word",height:"max-content"},messageArea:{height:"calc(100% - ".concat(e.spacing(18),"px)"),overflowY:"scroll",marginTop:e.spacing(2),marginBottom:e.spacing(2)}}})),S=function(e){var t=Object(f.a)(),a=E();return C(p.a,{item:!0,container:!0,justify:e.me?"flex-end":"flex-start"},C(v.a,{className:a.messageBubble,elevation:0,style:{backgroundColor:t.palette[e.me?"primary":"secondary"].main}},C(j.a,null,e.children)))},k=function(e){var t=Object(d.a)().t,a=E(),n=Object(o.useState)(""),r=n[0],s=n[1],i=Object(o.useRef)(null);function u(){e.onSend&&""!=r&&e.onSend(r),s("")}return Object(o.useEffect)((function(){i&&i.current.scrollIntoView()}),[i,e.messages]),C(l.a.Fragment,null,C(v.a,{square:!0,className:a.messageContainer},C(p.a,{className:a.messageGridContainer,container:!0,direction:"column",spacing:2,justify:"flex-end"},C(p.a,{container:!0,alignItems:"center",justify:"center"},C(p.a,{item:!0},C(j.a,{variant:"h6"},e.user?e.user.username:""))),C(p.a,{className:a.messageArea,container:!0,item:!0,spacing:2},e.messages?e.messages.map((function(e,t){var a=Object(c.a)(e,2),n=a[0],r=a[1];return C(S,{me:r},n)})):"",C("div",{ref:i})),C(p.a,{container:!0,item:!0,alignItems:"center",spacing:2},C(p.a,{item:!0,xs:!0},C(O.a,{className:a.messageField,placeholder:t("Aa"),variant:"outlined",value:r,onChange:function(e){return s(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&u()}})),C(p.a,{item:!0},C(y.a,{title:t("Message")},C(x.a,{onClick:function(){return u()}},C(N,null))))))))},I=a("wx14"),T=a("Ff2n"),F=(a("17x9"),a("iuhU")),R=a("H2TA"),A=a("VD++"),P=a("ucBr"),_=a("bfFb"),M=a("MquD"),B=a("i8i4"),D="undefined"===typeof window?o.useEffect:o.useLayoutEffect,L=o.forwardRef((function(e,t){var a=e.alignItems,n=void 0===a?"center":a,r=e.autoFocus,s=void 0!==r&&r,i=e.button,c=void 0!==i&&i,l=e.children,u=e.classes,d=e.className,m=e.component,f=e.ContainerComponent,p=void 0===f?"li":f,b=e.ContainerProps,g=(b=void 0===b?{}:b).className,h=Object(T.a)(b,["className"]),v=e.dense,j=void 0!==v&&v,O=e.disabled,y=void 0!==O&&O,x=e.disableGutters,w=void 0!==x&&x,N=e.divider,C=void 0!==N&&N,E=e.focusVisibleClassName,S=e.selected,k=void 0!==S&&S,R=Object(T.a)(e,["alignItems","autoFocus","button","children","classes","className","component","ContainerComponent","ContainerProps","dense","disabled","disableGutters","divider","focusVisibleClassName","selected"]),L=o.useContext(M.a),z={dense:j||L.dense||!1,alignItems:n},H=o.useRef(null);D((function(){s&&H.current&&H.current.focus()}),[s]);var V=o.Children.toArray(l),q=V.length&&Object(P.a)(V[V.length-1],["ListItemSecondaryAction"]),Y=o.useCallback((function(e){H.current=B.findDOMNode(e)}),[]),G=Object(_.a)(Y,t),W=Object(I.a)({className:Object(F.a)(u.root,d,z.dense&&u.dense,!w&&u.gutters,C&&u.divider,y&&u.disabled,c&&u.button,"center"!==n&&u.alignItemsFlexStart,q&&u.secondaryAction,k&&u.selected),disabled:y},R),K=m||"li";return c&&(W.component=m||"div",W.focusVisibleClassName=Object(F.a)(u.focusVisible,E),K=A.a),q?(K=W.component||m?K:"div","li"===p&&("li"===K?K="div":"li"===W.component&&(W.component="div")),o.createElement(M.a.Provider,{value:z},o.createElement(p,Object(I.a)({className:Object(F.a)(u.container,g),ref:G},h),o.createElement(K,W,V),V.pop()))):o.createElement(M.a.Provider,{value:z},o.createElement(K,Object(I.a)({ref:G},W),V))})),z=Object(R.a)((function(e){return{root:{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,"&$focusVisible":{backgroundColor:e.palette.action.selected},"&$selected, &$selected:hover":{backgroundColor:e.palette.action.selected},"&$disabled":{opacity:.5}},container:{position:"relative"},focusVisible:{},dense:{paddingTop:4,paddingBottom:4},alignItemsFlexStart:{alignItems:"flex-start"},disabled:{},divider:{borderBottom:"1px solid ".concat(e.palette.divider),backgroundClip:"padding-box"},gutters:{paddingLeft:16,paddingRight:16},button:{transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:e.palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}},secondaryAction:{paddingRight:48},selected:{}}}),{name:"MuiListItem"})(L),H=o.forwardRef((function(e,t){var a=e.classes,n=e.className,r=Object(T.a)(e,["classes","className"]),s=o.useContext(M.a);return o.createElement("div",Object(I.a)({className:Object(F.a)(a.root,n,"flex-start"===s.alignItems&&a.alignItemsFlexStart),ref:t},r))})),V=Object(R.a)({root:{minWidth:56,flexShrink:0},alignItemsFlexStart:{marginTop:8}},{name:"MuiListItemAvatar"})(H),q=a("5AJ6"),Y=Object(q.a)(o.createElement("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");var G=o.forwardRef((function(e,t){var a=e.alt,n=e.children,r=e.classes,s=e.className,i=e.component,c=void 0===i?"div":i,l=e.imgProps,u=e.sizes,d=e.src,m=e.srcSet,f=e.variant,p=void 0===f?"circle":f,b=Object(T.a)(e,["alt","children","classes","className","component","imgProps","sizes","src","srcSet","variant"]),g=null,h=function(e){var t=e.src,a=e.srcSet,n=o.useState(!1),r=n[0],s=n[1];return o.useEffect((function(){if(t||a){s(!1);var e=!0,n=new Image;return n.src=t,n.srcSet=a,n.onload=function(){e&&s("loaded")},n.onerror=function(){e&&s("error")},function(){e=!1}}}),[t,a]),r}({src:d,srcSet:m}),v=d||m,j=v&&"error"!==h;return g=j?o.createElement("img",Object(I.a)({alt:a,src:d,srcSet:m,sizes:u,className:r.img},l)):null!=n?n:v&&a?a[0]:o.createElement(Y,{className:r.fallback}),o.createElement(c,Object(I.a)({className:Object(F.a)(r.root,r.system,r[p],s,!j&&r.colorDefault),ref:t},b),g)})),W=Object(R.a)((function(e){return{root:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},colorDefault:{color:e.palette.background.default,backgroundColor:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[600]},circle:{},rounded:{borderRadius:e.shape.borderRadius},square:{borderRadius:0},img:{width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4},fallback:{width:"75%",height:"75%"}}}),{name:"MuiAvatar"})(G),K=o.forwardRef((function(e,t){var a=e.children,n=e.classes,r=e.className,s=e.disableTypography,i=void 0!==s&&s,c=e.inset,l=void 0!==c&&c,u=e.primary,d=e.primaryTypographyProps,m=e.secondary,f=e.secondaryTypographyProps,p=Object(T.a)(e,["children","classes","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"]),b=o.useContext(M.a).dense,g=null!=u?u:a;null==g||g.type===j.a||i||(g=o.createElement(j.a,Object(I.a)({variant:b?"body2":"body1",className:n.primary,component:"span",display:"block"},d),g));var h=m;return null==h||h.type===j.a||i||(h=o.createElement(j.a,Object(I.a)({variant:"body2",className:n.secondary,color:"textSecondary",display:"block"},f),h)),o.createElement("div",Object(I.a)({className:Object(F.a)(n.root,r,b&&n.dense,l&&n.inset,g&&h&&n.multiline),ref:t},p),g,h)})),$=Object(R.a)({root:{flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},multiline:{marginTop:6,marginBottom:6},dense:{},inset:{paddingLeft:56},primary:{},secondary:{}},{name:"MuiListItemText"})(K),J=a("eD//"),Q=l.a.createElement,X=Object(m.a)((function(e){return{container:{height:"100%",width:"100%",padding:e.spacing(2)},chatHeadsContainer:{height:"100%",width:"100%",overflowY:"scroll"},chatHeadContainer:{borderRadius:"".concat(e.spacing(1),"px")}}})),U=function(e){var t=X();return Q(z,{className:t.chatHeadContainer,button:!0,onClick:function(){return e.onSelect(e.user)}},Q(V,null,Q(W,null,e.user.username.split(" ").map((function(e){return e[0]})).slice(0,2).join(""))),Q($,{primary:e.user.username,secondary:e.children}))},Z=function(e){Object(f.a)(),Object(d.a)().t;var t=X();return Q(l.a.Fragment,null,Q(v.a,{square:!0,className:t.container},Q(J.a,{className:t.chatHeadsContainer},e.heads.map((function(t){return Q(U,{user:t.user,onSelect:function(t){return e.onSelect(t)}},t.message)})))))},ee=l.a.createElement,te=Object(m.a)((function(e){return{container:{width:"100%",padding:e.spacing(2)},bar:{width:"100%"}}})),ae=function(e){Object(f.a)();var t=Object(d.a)().t,a=te();return ee(l.a.Fragment,null,ee(v.a,{square:!0,className:a.container},ee(O.a,{className:a.bar,value:e.value,onChange:e.onChange,placeholder:t("Search"),variant:"outlined"})))},ne=l.a.createElement,re=Object(m.a)((function(e){return{}}));t.default=function(){var e=Object(u.useRouter)(),t=(Object(f.a)(),re(),Object(d.a)().t,Object(b.c)()),a=Object(c.a)(t,2),r=a[0],m=a[1],v=Object(o.useState)([]),j=v[0],O=v[1],y=Object(o.useState)([]),x=y[0],w=y[1],N=Object(o.useState)(null),C=N[0],E=N[1],S=Object(o.useState)([]),I=S[0],T=S[1],F=Object(o.useState)(""),R=F[0],A=F[1],P=Object(o.useState)([]),_=P[0],M=P[1];return Object(o.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)("directMessages");case 2:(t=e.sent).direct_messages&&O(t.direct_messages);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e();var a=setInterval((function(){return e()}),1e4);return function(){clearInterval(a)}}),[]),Object(o.useEffect)((function(){r||m||e.push("/")}),[m,r]),Object(o.useEffect)((function(){var e=[],t={};Object(n.a)(j).reverse().forEach((function(a){var n=a.from.id==m.id?a.to:a.from;t[n.id]||(e.push(n.id),t[n.id]={user:n,message:a.message})})),T(e.map((function(e){return t[e]})))}),[j]),Object(o.useEffect)((function(){I&&I.length>0&&!C&&E(I[0].user)}),[C,I]),Object(o.useEffect)((function(){if(C){w(j.filter((function(e){return function(e){var t=e.to.id==C.id;return m&&C.id==m.id?t:t||e.from.id==C.id}(e)})))}}),[C,j,m]),Object(o.useEffect)((function(){""!=R&&Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.a)("users","find",{username:R});case 2:(t=e.sent).users&&M(t.users);case 4:case"end":return e.stop()}}),e)})))()}),[R]),r?ne(g.a,null):ne(l.a.Fragment,null,ne(h.a,null),ne(p.a,{style:{height:"91vh"},container:!0},ne(p.a,{item:!0,container:!0,direction:"column",md:3,xs:6,style:{height:"100%"}},ne(p.a,{item:!0},ne(ae,{value:R,onChange:function(e){return A(e.target.value)}})),ne(p.a,{item:!0,xs:!0},ne(Z,{heads:""!=R?_.map((function(e){return{user:e,message:""}})):I,onSelect:function(e){E(e),A("")}}))),ne(p.a,{item:!0,container:!0,md:9,xs:6,style:{height:"100%"}},ne(k,{user:C,messages:x.map((function(e){return[e.message,e.from.id==m.id]})),onSend:function(){var e=Object(i.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m||!C){e.next=5;break}return e.next=3,Object(b.a)("directMessages","create",{from:m.id,to:C.id,message:t});case 3:a=e.sent,O([].concat(Object(n.a)(j),[a]));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}))))}}},[["YrAi",0,2,5,1,3,4,6,7,8,9]]]);